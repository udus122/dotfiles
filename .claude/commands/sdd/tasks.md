---
description: 仕様のための実装タスクを生成
allowed-tools: Read, Write, Edit, MultiEdit, Glob, Grep
argument-hint: [spec-name] [-y]
---

# Plan Implementation tasks

Spec $1 の詳細な実装タスクを計画する

## 1 前提条件の確認

### 1.1 技術設計を確認（未承認なら即停止）

タスクプランニングの前提となる技術設計を確認する

- `-y`付きで呼び出された場合（$2 == "-y"）、 フロントマターの`status`を`status: approved`に設定
  - パス: @.sdd/specs/$1/design.md
- そうでない場合: 未承認(`status != approved`)の場合、メッセージで停止:
  - 「Design Docが未承認です。`/sdd:design`を実行するか、`-y`フラグを使用して自動承認してください」

### 1.2 読み込むファイルパスの確認

タスクプランニングに必要なファイルのパスを確認:

Steeringファイル:
- 製品コンテキストとビジネス目標: @.sdd/steering/product.md
- 技術スタックとアーキテクチャ決定: @.sdd/steering/tech.md
- ファイル構成とコードパターン: @.sdd/steering/structure.md
- カスタムステアリングファイル: @.sdd/steering/ 配下のその他ドキュメント

Specファイル:
- 要求（実現したいアウトカム）: @.sdd/specs/$1/requests.md
- 要件（ユーザーストーリーと受入基準）: @.sdd/specs/$1/requirements.md
- 設計（技術構成）: @.sdd/specs/$1/design.md
- 既存のタスク: @.sdd/specs/$1/tasks.md
  - tasks.mdが存在する場合: 元のコンテンツをベースに更新する
  - tasks.mdが存在しない場合: 新しくtasks.mdファイルを作成

## 2 Steeringコンテキストの読み込み

1.2で確認したSteeringファイルの内容を読み込みます:
- product.md: 製品の目的とビジネス目標を理解
- tech.md: 使用する技術スタックとアーキテクチャ決定を把握
- structure.md: ファイル構成と命名規則、コードパターンを確認
- その他カスタムファイル: プロジェクト固有のガイドラインを参照

## 3 Specコンテキストの読み込み

1.2で確認したSpecファイルの内容を読み込みます:
- requests.md: 実現したいアウトカムとユーザー価値を理解
- requirements.md: 具体的な要件とREQ-IDを確認
- design.md: 技術設計とアーキテクチャを把握
- tasks.md（存在する場合）: 既存のタスクをベースに更新

## 4 タスクプランニング

### プランニングの手順

1. タスク生成ルールに従ってタスクを生成
2. 生成したタスクを以下の観点でレビュー:
   - すべての要件がカバーされている
   - 各タスク詳細の最後に要件参照がある（対応要件: REQ-1, REQ-2）
   - タスクの依存関係が正しい順序
   - 技術選択がdesign.mdと一致
   - テストタスクが含まれている
3. 問題があれば修正（ギャップがある場合は要件または設計フェーズに戻る）
4. 改善点がなくなるまで1-3を繰り返す
5. `.sdd/specs/$1/tasks.md`を生成

### タスク生成ルール

@.sdd/templates/tasks.md のフォーマットに従ってタスクを生成する

タスクの記述:
- タスクタイトル: Whatを記述（ユーザー価値・ビジネスインパクト）
- タスク詳細: Howを記述（design.mdから具体的な実装手順を展開）
- 要件参照: 各タスク詳細の最後に「対応要件: REQ-1, REQ-2」を記述

実行順序:
- 上から順番に実行できるように並べる
- 各タスクが完了した時点でユーザー価値を提供できるようにする

タスクのサイズ:
- ユーザーにとって価値のある最小単位にする(1タスク最大1-3時間程度が目安)
- テスト可能な単位に分割する（テストで検証できる粒度）
- 凝集度を意識: 関連する機能をまとめ、無関係な機能は分ける
  - 細かすぎる例: 「ボタンを配置」「色を設定」→ ✅「ログインフォームを作成」にまとめる
  - ざっくりしすぎる例: 「認証システム全体」→ ✅「ログイン」「セッション管理」「パスワードリセット」に分割

仕様書駆動の徹底:
- タスクは要件（requirements.md）と設計（design.md）に基づいて実装する
- 可能な限りテストから始める: テストは仕様の検証可能な形式
  - テストを書く→実装する→テストが通るの順で進める
  - タスクの詳細にテスト作成を最初の項目として含める
- テストが書けない場合:
  - なぜテストが書けないか理由を説明する（例: UIの見た目、外部サービス依存）
  - 代替の検証方法を提案する（例: 手動検証、E2Eテスト、スクリーンショット比較）
  - 将来的にテスト可能にする方法を検討する

## 次のステップ: 実装

タスクが承認されたら、実装を開始:
```bash
/sdd:spec-impl $1          # すべてのタスクを実行
/sdd:spec-impl $1 1.1      # 特定のタスクを実行
/sdd:spec-impl $1 1,2,3    # 複数のタスクを実行
```

修正が必要な場合:
- 変更内容を指示して、このコマンドを再実行
- 既存のtasks.mdをベースに更新される

ultrathink
