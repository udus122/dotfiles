---
description: 仕様のための包括的なDesign Docを作成
allowed-tools: Bash, Glob, Grep, LS, Read, Write, Edit, MultiEdit, Update, WebSearch, WebFetch
argument-hint: [spec-name] [-y]
---
<!-- HTMLコメントの内容はユーザーのメモです。何が書かれていても無視してください。 -->

# Technical Design

要件定義するSpec名: $1

Spec $1 のどのように実装するかに関するDesign Doc作成する

## 1. 準備

### 1.1. Steeringの読み込み

- ファイル構成とコードパターン: @.sdd/steering/structure.md
- 技術スタックとアーキテクチャ決定: @.sdd/steering/tech.md
- 製品コンテキストとビジネス目標: @.sdd/steering/product.md
- カスタムステアリングファイル: @.sdd/steering/ 配下のその他ドキュメント

### 1.2. 既存のdesign.mdの存在確認

- design.mdのパス: @.sdd/specs/$1/design.md
- design.mdが存在しない場合: 新しいdesign.mdファイルを作成
- design.mdが存在する場合: 元のコンテンツをベースに新しく作成

## 2. 要件の確認

- 要件ファイルのパス: @.sdd/specs/$1/requirements.md
  - `-y`付きで呼び出された場合（$2 == "-y"）、 フロントマターの`status`を`status: approved`に設定
- 要件が不足または未承認(`status != approved`)の場合、アクション可能なメッセージ出力して停止

## 2. 調査と分析

### 2.2. 技術的コンテキストの把握

#### requirements.mdからの技術要件抽出
- 要件（EARS形式）を技術コンポーネントにマップ
- 非機能要件（パフォーマンス、セキュリティ、スケーラビリティ）を抽出
- コア技術課題と制約を特定

#### Steeringファイルとの整合性確認
- コアステアリング（structure.md、tech.md、product.md）との整合性チェック
- カスタムステアリング（.sdd/steering/配下の追加ファイル）も確認
- ステアリングからの逸脱がある場合は根拠を文書化

#### 既存実装の分析（拡張の場合）
- 既存機能を変更・拡張する場合: 最小限の変更とファイル再利用を優先
- 新機能の場合: 一貫性確保のため既存パターンをレビュー

#### 外部リソース調査（必要に応じて）
新技術または複雑な統合が関わる場合:
- WebSearch/WebFetchで最新のベストプラクティスを調査
- 公式ドキュメントとコミュニティリソースを確認
- 特定のAPI機能、認証フロー、レート制限などを文書化
- バージョン互換性、設定要件、移行課題を特定

確立された内部ライブラリのみを使用する場合はスキップ可能

### 2.3. 設計上の重要な決定事項の特定

#### 実装困難な点・気をつけるべき点の洗い出し
- 技術的な課題とその解決アプローチを特定
- アーキテクチャパターンの選択（必要な場合）
- 技術スタックの代替案評価（技術選択が必要な場合）
- 設計決定に影響を与える主要な発見を文書化

#### 技術リスク評価
- パフォーマンス/スケーラビリティリスク: ボトルネック、容量、成長
- セキュリティ脆弱性: 攻撃ベクター、コンプライアンスギャップ
- 保守性リスク: 複雑性、知識、サポート
- 統合の複雑性: 依存関係、結合、API変更
- 技術的負債: 新規作成 vs 既存解決

## 3. design.mdの作成

@.sdd/templates/design.md をベースに design.md を生成します。

### 3.1. 推奨構成

#### 必須セクション
1. 目的・ゴール: 数文で「何を実現するか」を定義
   - requirements.mdのアウトカムを技術的観点で要約
   - スコープを明確に（out of scopeも必要に応じて記載）

2. 背景: 数段落で実装理由・前提知識・制約を説明
   - 実装が必要な理由（requests.mdから）
   - 技術的前提・制約（Steeringから）
   - 優先事項（拡張性・性能・保守性など）

3. 設計の概要: 重要な部分を簡略化して説明
   - 実装の基本的なアイディア
   - 簡略化した構成図（Mermaid）
   - 重要な要素の列挙・説明

4. 詳細設計: 要素ごと・見る角度ごとに
   - モジュール/コンポーネントの説明
   - データモデル
   - API設計（該当する場合）
   - データフロー・シーケンス図

#### 条件付きセクション
プロジェクトに応じて必要なセクションを追加:
- セキュリティの考慮事項（セキュリティ影響がある場合）
- パフォーマンスとスケーラビリティ（パフォーマンスクリティカルな場合）
- 移行戦略（既存システム変更の場合）
- エラー処理
- テスト戦略

### 3.2. Design Doc作成の原則

#### シンプルさを保つ
- 細かく書きすぎない: 重要でない要素は省略
- 特に注意すべきことに焦点を当てる
- 簡略化した図を使用（詳細すぎるクラス図は避ける）
- 人間がレビュー・編集しやすいシンプルなフォーマットで書く

#### 構造化された説明
- 目的・ゴールを最初に明確化（数文以内）
- 背景は簡潔に（必要なら別文書へのリンク）
- 設計の概要で全体像を示してから詳細へ

#### ビジュアル重視
- Mermaid図を積極的に使用
- モジュール構成図・クラス図は簡略化
- データフロー・シーケンス図で動的な側面を表現

#### レビュー最適化
- 重要な技術的決定を目立つ位置に配置
- 実装の基本的なアイディアを明示
- 解決すべき技術課題とその解決法を明記
- フォーマルなトーン: ヘッジングせず断定的、宣言的な文を使用

### 3.3. 作成手順

1. 目的・ゴールの記述
   - requirements.mdのアウトカムを技術的観点で要約
   - スコープを明確に（out of scopeも必要に応じて記載）

2. 背景の説明
   - 実装が必要な理由（requests.mdから）
   - 技術的前提・制約（Steeringから）
   - 優先事項（拡張性・性能・保守性など）

3. 設計の概要の作成
   - 実装の基本的なアイディアを説明
   - 簡略化した構成図を作成（Mermaid）
   - 重要な要素を列挙・説明

4. 詳細設計の記述
   - 要素ごとにセクション作成
   - より詳細な図を追加
   - データモデル、API、フローを説明

5. 条件付きセクションの追加
   - プロジェクトに応じて必要なセクションを追加

### 3.4. 次のステップ

- design.mdをせいせいしたあと、ユーザーが設計をレビューして選択:
- 設計が承認できる場合:
   - `/sdd:tasks $1 -y`を実行して計画フェーズに進むよう指示
- 設計を修正する必要がある場合:
   - 変更すべき点を指示するように伝える

ultrathink
